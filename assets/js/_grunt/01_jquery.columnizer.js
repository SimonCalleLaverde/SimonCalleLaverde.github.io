(function(e){e.fn.columnize=function(a){var p={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,manualBreaks:!1,cssClassPrefix:""};a=e.extend(p,a);"string"==typeof a.width&&(a.width=parseInt(a.width,10),isNaN(a.width)&&(a.width=p.width));return this.each(function(){function f(c,a){var b=a?".":"";return q.length?b+q+"-"+c:b+c}function z(c,b,m,d){for(;(A||m.height()<d)&&b[0].childNodes.length;){var g=
b[0].childNodes[0];if(e(g).find(f("columnbreak",!0)).length||e(g).hasClass(f("columnbreak")))return;c.append(g)}if(0!==c[0].childNodes.length){g=c[0].childNodes;g=g[g.length-1];c[0].removeChild(g);g=e(g);if(3==g[0].nodeType){var l=g[0].nodeValue,n=a.width/18;a.accuracy&&(n=a.accuracy);var h;for(h=null;m.height()<d&&l.length;){var k=l.indexOf(" ",n);h=-1!=k?l.substring(0,l.indexOf(" ",n)):l;h=document.createTextNode(h);c.append(h);l=l.length>n&&-1!=k?l.substring(k):""}m.height()>=d&&null!==h&&(c[0].removeChild(h),
l=h.nodeValue+l);if(l.length)g[0].nodeValue=l;else return!1}b.contents().length?b.prepend(g):b.append(g);return 3==g[0].nodeType}}function B(b,a,e,d){if(!b.contents(":last").find(f("columnbreak",!0)).length&&!b.contents(":last").hasClass(f("columnbreak"))&&a.contents().length&&(a=a.contents(":first"),1==a.get(0).nodeType)){var c=a.clone(!0);a.hasClass(f("columnbreak"))?(b.append(c),a.remove()):A?(b.append(c),a.remove()):1!=c.get(0).nodeType||c.hasClass(f("dontend"))||(b.append(c),c.is("img")&&e.height()<
d+20?a.remove():!a.hasClass(f("dontsplit"))&&e.height()<d+20?a.remove():c.is("img")||a.hasClass(f("dontsplit"))?c.remove():(c.empty(),z(c,a,e,d)?a.addClass(f("split")):(a.addClass(f("split")),a.children().length&&B(c,a,e,d)),0===c.get(0).childNodes.length&&c.remove()))}}function I(){if(!b.data("columnized")||1!=b.children().length){b.data("columnized",!0);b.data("columnizing",!0);b.empty();b.append(e("<div class='"+f("first")+" "+f("last")+" "+f("column")+" ' style='width:100%; float: "+a.columnFloat+
";'></div>"));$col=b.children().eq(b.children().length-1);$destroyable=t.clone(!0);if(a.overflow){targetHeight=a.overflow.height;z($col,$destroyable,$col,targetHeight);for($destroyable.contents().find(":first-child").hasClass(f("dontend"))||B($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&x($col.contents(":last").get(0));){var c=$col.contents(":last");c.remove();$destroyable.prepend(c)}c="";for(var l=document.createElement("DIV");0<$destroyable[0].childNodes.length;){var m=$destroyable[0].childNodes[0];
if(m.attributes)for(var d=0;d<m.attributes.length;d++)0===m.attributes[d].nodeName.indexOf("jQuery")&&m.removeAttribute(m.attributes[d].nodeName);l.innerHTML="";l.appendChild($destroyable[0].childNodes[0]);c+=l.innerHTML}e(a.overflow.id)[0].innerHTML=c}else $col.append($destroyable);b.data("columnizing",!1);a.overflow&&a.overflow.doneFunc&&a.overflow.doneFunc()}}function x(a){return 3==a.nodeType?/^\s+$/.test(a.nodeValue)?a.previousSibling?x(a.previousSibling):!1:!1:1!=a.nodeType?!1:e(a).hasClass(f("dontend"))?
!0:0===a.childNodes.length?!1:x(a.childNodes[a.childNodes.length-1])}function v(){if(F!=b.width()){F=b.width();var c=Math.round(b.width()/a.width),l=a.width,m=a.height;a.columns&&(c=a.columns);A&&(c=t.find(f("columnbreak",!0)).length+1,l=!1);if(1>=c)return I();if(!b.data("columnizing")){b.data("columnized",!0);b.data("columnizing",!0);b.empty();b.append(e("<div style='width:"+Math.floor(100/c)+"%; float: "+a.columnFloat+";'></div>"));var d=b.children(":last");d.append(t.clone());G=d.height();b.empty();
var g=G/c,r=3,n=!1;a.overflow?(r=1,g=a.overflow.height):m&&l&&(r=1,g=m,n=!0);for(m=0;m<r&&20>m;m++){b.empty();try{var h=t.clone(!0)}catch(J){h=t.clone()}h.css("visibility","hidden");for(var k=0;k<c;k++){var u=0===k?f("first"):"";u+=" "+f("column");u=k==c-1?f("last")+" "+u:u;b.append(e("<div class='"+u+"' style='width:"+Math.floor(100/c)+"%; float: "+a.columnFloat+";'></div>"))}for(k=0;k<c-(a.overflow?0:1)||n&&h.contents().length;){b.children().length<=k&&b.append(e("<div class='"+u+"' style='width:"+
Math.floor(100/c)+"%; float: "+a.columnFloat+";'></div>"));d=b.children().eq(k);n&&d.width(l+"px");z(d,h,d,g);for(B(d,h,d,g);d.contents(":last").length&&x(d.contents(":last").get(0));){var w=d.contents(":last");w.remove();h.prepend(w)}k++;0===d.contents().length&&h.contents().length?d.append(h.contents(":first")):k!=c-(a.overflow?0:1)||a.overflow||h.find(f("columnbreak",!0)).length&&c++}if(a.overflow&&!n)if(document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.")){w="";for(var p=document.createElement("DIV");0<
h[0].childNodes.length;){var y=h[0].childNodes[0];for(k=0;k<y.attributes.length;k++)0===y.attributes[k].nodeName.indexOf("jQuery")&&y.removeAttribute(y.attributes[k].nodeName);p.innerHTML="";p.appendChild(h[0].childNodes[0]);w+=p.innerHTML}e(a.overflow.id)[0].innerHTML=w}else e(a.overflow.id).empty().append(h.contents().clone(!0));else if(n)b.children().each(function(a){d=b.children().eq(a);d.width(l+"px");0===a?d.addClass(f("first")):a==b.children().length-1?d.addClass(f("last")):(d.removeClass(f("first")),
d.removeClass(f("last")))}),b.width(b.children().length*l+"px");else{d=b.children().eq(b.children().length-1);h.contents().each(function(){d.append(e(this))});d.height();var q=0,C=1E7,D=0,E=!1,v=0;b.children().each(function(a){return function(b){b=a.children().eq(b);b.children(":last").find(f("columnbreak",!0)).length||(b=b.height(),E=!1,q+=b,b>D&&(D=b,E=!0),b<C&&(C=b),v++)}}(b));k=q/v;0===q?m=r:a.lastNeverTallest&&E?(g+=30,m==r-1&&r++):30<D-C?g=k+30:20<Math.abs(k-g)?g=k:m=r}b.append(e("<br style='clear:both;'>"))}b.find(f("column",
!0)).find(":first"+f("removeiffirst",!0)).remove();b.find(f("column",!0)).find(":last"+f("removeiflast",!0)).remove();b.data("columnizing",!1);a.overflow&&a.overflow.doneFunc();a.doneFunc()}}}var b=a.target?e(a.target):e(this),G=e(this).height(),t=e("<div></div>"),F=0,A=a.manualBreaks,q=p.cssClassPrefix;"string"==typeof a.cssClassPrefix&&(q=a.cssClassPrefix);t.append(e(this).contents().clone(!0));if(!a.ignoreImageLoading&&!a.target&&!b.data("imageLoaded")&&(b.data("imageLoaded",!0),0<e(this).find("img").length)){var H=
function(b,e){return function(){b.data("firstImageLoaded")||(b.data("firstImageLoaded","true"),b.empty().append(e.children().clone(!0)),b.columnize(a))}}(e(this),t);e(this).find("img").one("load",H);e(this).find("img").one("abort",H);return}b.empty();v();a.buildOnce||e(window).resize(function(){a.buildOnce||(b.data("timeout")&&clearTimeout(b.data("timeout")),b.data("timeout",setTimeout(v,200)))})})}})(jQuery);